
<!-- saved from url=(0032)http://www.makelinux.net/alp/014 -->
<html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"> 
 
<title>Compiling with gcc</title>  <style> 
<!-- /* Style Definitions */ p.MsoNormal, li.MsoNormal, div.MsoNormal 	{margin:0cm; 	margin-bottom:.0001pt; 	font-size:12.0pt; 	font-family:"Times New Roman";} h3 	{margin-right:0cm; 	margin-left:0cm; 	font-size:13.5pt; 	font-family:"Times New Roman"; 	color:#354278;} h4 	{margin-right:0cm; 	margin-left:0cm; 	font-size:12.0pt; 	font-family:"Times New Roman"; 	color:#354278;} h5 	{margin-right:0cm; 	margin-left:0cm; 	font-size:10.0pt; 	font-family:"Times New Roman"; 	color:#354278;} a:link, span.MsoHyperlink 	{color:blue; 	text-decoration:underline;} a:visited, span.MsoHyperlinkFollowed 	{color:purple; 	text-decoration:underline;} pre 	{margin:0cm; 	margin-bottom:.0001pt; 	font-size:11.5pt; 	font-family:"Courier New"; 	color:#354278;} tt 	{font-family:"Courier New"; 	color:#354278;} p.doctext, li.doctext, div.doctext 	{margin-right:0cm; 	margin-left:0cm; 	font-size:10.5pt; 	font-family:"Times New Roman"; 	color:black;} p.docfootnote, li.docfootnote, div.docfootnote 	{margin-right:0cm; 	margin-left:0cm; 	font-size:9.0pt; 	font-family:Arial; 	color:#606060;} span.docemphasis1 	{font-style:italic;} @page Section1 	{size:595.3pt 841.9pt; 	margin:3.0cm 2.0cm 3.0cm 2.0cm;} div.Section1 	{page:Section1;} --> </style>  </head>  
<body lang="DA" link="blue" vlink="purple">  <div class="Section1">  
<h3><span lang="EN-GB" style="font-size:15.0pt;font-family:Arial">1.2 Compiling with GCC</span></h3>  
<p class="doctext"><span lang="EN-GB">A <span class="docemphasis1">compiler</span> turns human-readable source code into machine-readable object code that can actually run. The compilers of choice on Linux systems are all part of the GNU Compiler Collection, usually known as GCC. </span><sup><span style="font-size: 9.0pt;font-family:Arial;color:#606060"><a href="http://%20/JVXSL.asp?x=1&mode=section&sortKey=rank&sortOrder=desc&view=book&xmlid=0-7357-1043-0/ch01lev1sec2&open=true&catid=&s=1&b=1&f=1&t=1&c=1&u=1#ch01footnote03#ch01footnote03"><span lang="EN-GB" style="color:#003399">[3]</span></a></span></sup><span lang="EN-GB"> GCC also include compilers for C, C++, Java, Objective-C, Fortran, and Chill. This book focuses mostly on C and C++ programming.</span></p>  
<p class="docfootnote"><a name="ch01footnote03"><sup><span lang="EN-GB">[3]</span></sup></a><span lang="EN-GB"> For more information about GCC, visit </span><a href="http://gcc.gnu.org/" target="_blank"><span lang="EN-GB" style="color:#003399">http://gcc.gnu.org</span></a><span lang="EN-GB">.</span></p>  
<p class="doctext"><span lang="EN-GB">Suppose that you have a project like the one in </span><a href="http://%20/JVXSL.asp?x=1&mode=section&sortKey=rank&sortOrder=desc&view=book&xmlid=0-7357-1043-0/ch01lev1sec2&open=true&catid=&s=1&b=1&f=1&t=1&c=1&u=1#ch01list02#ch01list02"><span lang="EN-GB" style="color:#003399">Listing 1.2</span></a><span lang="EN-GB"> with one C++ source file (</span><tt><span lang="EN-GB" style="font-size:11.5pt">reciprocal.cpp</span></tt><span lang="EN-GB">) and one C source file (</span><tt><span lang="EN-GB" style="font-size:11.5pt">main.c</span></tt><span lang="EN-GB">) like in </span><a href="http://%20/JVXSL.asp?x=1&mode=section&sortKey=rank&sortOrder=desc&view=book&xmlid=0-7357-1043-0/ch01lev1sec2&open=true&catid=&s=1&b=1&f=1&t=1&c=1&u=1#ch01list01#ch01list01"><span lang="EN-GB" style="color:#003399">Listing 1.1</span></a><span lang="EN-GB">. These two files are supposed to be compiled and then linked together to produce a program called </span><tt><span lang="EN-GB" style="font-size:11.5pt">reciprocal</span></tt><span lang="EN-GB">. </span><sup><span style="font-size:9.0pt;font-family:Arial; color:#606060"><a href="http://%20/JVXSL.asp?x=1&mode=section&sortKey=rank&sortOrder=desc&view=book&xmlid=0-7357-1043-0/ch01lev1sec2&open=true&catid=&s=1&b=1&f=1&t=1&c=1&u=1#ch01footnote04#ch01footnote04"><span lang="EN-GB" style="color:#003399">[4]</span></a></span></sup><span lang="EN-GB"> This program will compute the reciprocal of an integer.</span></p>  
<p class="docfootnote"><a name="ch01footnote04"><sup><span lang="EN-GB">[4]</span></sup></a><span lang="EN-GB"> In Windows, executables usually have names that end in </span><tt><span lang="EN-GB" style="font-size:11.5pt">.exe</span></tt><span lang="EN-GB">. Linux programs, on the other hand, usually have no extension. So, the Windows equivalent of this program would probably be called </span><tt><span lang="EN-GB" style="font-size:11.5pt">reciprocal.exe</span></tt><span lang="EN-GB">; the Linux version is just plain </span><tt><span lang="EN-GB" style="font-size: 11.5pt">reciprocal</span></tt><span lang="EN-GB">.</span></p>  
<h5><a name="ch01list01"></a><span lang="EN-GB" style="font-size:10.5pt;font-family: Arial">Listing 1.1 (<span class="docemphasis1">main.c</span>) C source file—<span class="docemphasis1">main.c</span></span></h5>  <pre><span lang="EN-GB">#include &lt;stdio.h&gt; </span></pre><pre><span lang="EN-GB">#include "reciprocal.hpp" </span></pre><pre><span lang="EN-GB">&nbsp;</span></pre><pre><span lang="EN-GB">int main (int argc, char **argv) </span></pre><pre>{</pre><pre>&nbsp; int i; </pre><pre>&nbsp;</pre><pre>&nbsp; i = atoi (argv[1]); </pre><pre>&nbsp;&nbsp;<span lang="EN-GB">printf ("The reciprocal of %d is %g\n", i, reciprocal (i)); </span></pre><pre><span lang="EN-GB">&nbsp;&nbsp;return 0; </span></pre><pre><span lang="EN-GB">} </span></pre>  
<h5><a name="ch01list02"></a><span lang="EN-GB" style="font-size:10.5pt;font-family: Arial">Listing 1.2 (<span class="docemphasis1">reciprocal.cpp</span>) C++ source file—<span class="docemphasis1">reciprocal.cpp</span></span></h5>  <pre><span lang="EN-GB">#include &lt;cassert&gt; </span></pre><pre><span lang="EN-GB">#include "reciprocal.hpp" </span></pre><pre><span lang="EN-GB">&nbsp;</span></pre><pre><span lang="EN-GB">double reciprocal (int i) {</span></pre><pre><span lang="EN-GB">&nbsp; // I should be non-zero. </span></pre><pre><span lang="EN-GB">&nbsp;&nbsp;assert (i != 0); </span></pre><pre><span lang="EN-GB">&nbsp;&nbsp;return 1.0/i; </span></pre><pre><span lang="EN-GB">} </span></pre>  
<p class="doctext"><span lang="EN-GB">There's also one header file called </span><tt><span lang="EN-GB" style="font-size:11.5pt">reciprocal.hpp</span></tt><span lang="EN-GB"> (see </span><a href="http://%20/JVXSL.asp?x=1&mode=section&sortKey=rank&sortOrder=desc&view=book&xmlid=0-7357-1043-0/ch01lev1sec2&open=true&catid=&s=1&b=1&f=1&t=1&c=1&u=1#ch01list03#ch01list03"><span lang="EN-GB" style="color:#003399">Listing 1.3</span></a><span lang="EN-GB">).</span></p>  
<h5><a name="ch01list03"></a><span lang="EN-GB" style="font-size:10.5pt;font-family: Arial">Listing 1.3 (<span class="docemphasis1">reciprocal.hpp</span>) Header file—<span class="docemphasis1">reciprocal.hpp</span></span></h5>  <pre><span lang="EN-GB">#ifdef __cplusplus </span></pre><pre><span lang="EN-GB">extern "C" {</span></pre><pre><span lang="EN-GB">#endif </span></pre><pre><span lang="EN-GB">&nbsp;</span></pre><pre><span lang="EN-GB">extern double reciprocal (int i); </span></pre><pre><span lang="EN-GB">&nbsp;</span></pre><pre><span lang="EN-GB">#ifdef __cplusplus </span></pre><pre><span lang="EN-GB">} </span></pre><pre><span lang="EN-GB">#endif </span></pre>  
<p class="doctext"><span lang="EN-GB">The first step is to turn the C and C++ source code into object code.</span></p>  
<h4><a name="ch01lev2sec4"></a><span lang="EN-GB" style="font-size:13.0pt; font-family:Arial">1.2.4 Compiling a Single Source File</span></h4>  
<p class="doctext"><span lang="EN-GB">The name of the C compiler is </span><tt><span lang="EN-GB" style="font-size:11.5pt">gcc</span></tt><span lang="EN-GB">. To compile a C source file, you use the </span><tt><span lang="EN-GB" style="font-size:11.5pt">-c</span></tt><span lang="EN-GB"> option. So, for example, entering this at the command prompt compiles the </span><tt><span lang="EN-GB" style="font-size:11.5pt">main.c</span></tt><span lang="EN-GB"> source file:</span></p>  <pre><span lang="EN-GB">&nbsp;</span></pre><pre><span lang="EN-GB">% gcc -c main.c </span></pre>  
<p class="doctext"><span lang="EN-GB">The resulting object file is named </span><tt><span lang="EN-GB" style="font-size:11.5pt">main.o</span></tt><span lang="EN-GB">.</span></p>  
<p class="doctext"><span lang="EN-GB">The C++ compiler is called </span><tt><span lang="EN-GB" style="font-size:11.5pt">g++</span></tt><span lang="EN-GB">. Its operation is very similar to </span><tt><span lang="EN-GB" style="font-size:11.5pt">gcc</span></tt><span lang="EN-GB">; compiling </span><tt><span lang="EN-GB" style="font-size:11.5pt">reciprocal.cpp</span></tt><span lang="EN-GB"> is accomplished by entering the following:</span></p>  <pre><span lang="EN-GB">&nbsp;</span></pre><pre><span lang="EN-GB">% g++ -c reciprocal.cpp </span></pre>  
<p class="doctext"><span lang="EN-GB">The </span><tt><span lang="EN-GB" style="font-size:11.5pt">-c</span></tt><span lang="EN-GB"> option tells </span><tt><span lang="EN-GB" style="font-size:11.5pt">g++</span></tt><span lang="EN-GB"> to compile the program to an object file only; without it, </span><tt><span lang="EN-GB" style="font-size:11.5pt">g++</span></tt><span lang="EN-GB"> will attempt to link the program to produce an executable. After you've typed this command, you'll have an object file called </span><tt><span lang="EN-GB" style="font-size:11.5pt">reciprocal.o</span></tt><span lang="EN-GB">.</span></p>  
<p class="doctext"><span lang="EN-GB">You'll probably need a couple other options to build any reasonably large program. The </span><tt><span lang="EN-GB" style="font-size:11.5pt">-I</span></tt><span lang="EN-GB"> option is used to tell GCC where to search for header files. By default, GCC looks in the current directory and in the directories where headers for the standard libraries are installed. If you need to include header files from somewhere else, you'll need the </span><tt><span lang="EN-GB" style="font-size:11.5pt">-I</span></tt><span lang="EN-GB"> option. For example, suppose that your project has one directory called </span><tt><span lang="EN-GB" style="font-size:11.5pt">src</span></tt><span lang="EN-GB">, for source files, and another called </span><tt><span lang="EN-GB" style="font-size:11.5pt">include</span></tt><span lang="EN-GB">. You would compile </span><tt><span lang="EN-GB" style="font-size:11.5pt">reciprocal.cpp</span></tt><span lang="EN-GB"> like this to indicate that </span><tt><span lang="EN-GB" style="font-size:11.5pt">g++</span></tt><span lang="EN-GB"> should use the </span><tt><span lang="EN-GB" style="font-size:11.5pt">../include</span></tt><span lang="EN-GB"> directory in addition to find </span><tt><span lang="EN-GB" style="font-size: 11.5pt">reciprocal.hpp</span></tt><span lang="EN-GB">:</span></p>  <pre><span lang="EN-GB">&nbsp;</span></pre><pre><span lang="EN-GB">% g++ -c -I ../include reciprocal.cpp </span></pre>  
<p class="doctext"><span lang="EN-GB">Sometimes you'll want to define macros on the command line. For example, in production code, you don't want the overhead of the assertion check present in </span><tt><span lang="EN-GB" style="font-size:11.5pt">reciprocal.cpp</span></tt><span lang="EN-GB">; that's only there to help you debug the program. You turn off the check by defining the macro </span><tt><span lang="EN-GB" style="font-size:11.5pt">NDEBUG</span></tt><span lang="EN-GB">. You could add an explicit </span><tt><span lang="EN-GB" style="font-size:11.5pt">#define</span></tt><span lang="EN-GB"> to </span><tt><span lang="EN-GB" style="font-size:11.5pt">reciprocal.cpp</span></tt><span lang="EN-GB">, but that would require changing the source itself. It's easier to simply define </span><tt><span lang="EN-GB" style="font-size:11.5pt">NDEBUG</span></tt><span lang="EN-GB"> on the command line, like this:</span></p>  <pre><span lang="EN-GB">&nbsp;</span></pre><pre><span lang="EN-GB">% g++ -c -D NDEBUG reciprocal.cpp </span></pre>  
<p class="doctext"><span lang="EN-GB">If you had wanted to define </span><tt><span lang="EN-GB" style="font-size:11.5pt">NDEBUG</span></tt><span lang="EN-GB"> to some particular value, you could have done something like this:</span></p>  <pre><span lang="EN-GB">&nbsp;</span></pre><pre><span lang="EN-GB">% g++ -c -D NDEBUG=3 reciprocal.cpp </span></pre>  
<p class="doctext"><span lang="EN-GB">If you're really building production code, you probably want to have GCC optimize the code so that it runs as quickly as possible. You can do this by using the </span><tt><span lang="EN-GB" style="font-size:11.5pt">-O2</span></tt><span lang="EN-GB"> command-line option. (GCC has several different levels of optimization; the second level is appropriate for most programs.) For example, the following compiles </span><tt><span lang="EN-GB" style="font-size:11.5pt">reciprocal.cpp</span></tt><span lang="EN-GB"> with optimization turned on:</span></p>  <pre><span lang="EN-GB">&nbsp;</span></pre><pre><span lang="EN-GB">% g++ -c -O2 reciprocal.cpp </span></pre>  
<p class="doctext"><span lang="EN-GB">Note that compiling with optimization can make your program more difficult to debug with a debugger (see </span><a href="http://%20/?xmlid=0-7357-1043-0/ch01lev1sec4#ch01lev1sec4"><span lang="EN-GB" style="color:#003399">Section 1.4</span></a><span lang="EN-GB">, "Debugging with GDB"). Also, in certain instances, compiling with optimization can uncover bugs in your program that did not manifest themselves previously.</span></p>  
<p class="doctext"><span lang="EN-GB">You can pass lots of other options to </span><tt><span lang="EN-GB" style="font-size:11.5pt">gcc</span></tt><span lang="EN-GB"> and </span><tt><span lang="EN-GB" style="font-size:11.5pt">g++</span></tt><span lang="EN-GB">. The best way to get a complete list is to view the online documentation. You can do this by typing the following at your command prompt:</span></p>  <pre><span lang="EN-GB">&nbsp;</span></pre><pre><span lang="EN-GB">% info gcc </span></pre>  
<h4><a name="ch01lev2sec5"></a><span lang="EN-GB" style="font-size:13.0pt; font-family:Arial">1.2.5 Linking Object Files</span></h4>  
<p class="doctext"><span lang="EN-GB">Now that you've compiled </span><tt><span lang="EN-GB" style="font-size:11.5pt">main.c</span></tt><span lang="EN-GB"> and </span><tt><span lang="EN-GB" style="font-size:11.5pt">utilities.cpp</span></tt><span lang="EN-GB">, you'll want to link them. You should always use </span><tt><span lang="EN-GB" style="font-size:11.5pt">g++</span></tt><span lang="EN-GB"> to link a program that contains C++ code, even if it also contains C code. If your program contains only C code, you should use </span><tt><span lang="EN-GB" style="font-size:11.5pt">gcc</span></tt><span lang="EN-GB"> instead. Because this program contains both C and C++, you should use </span><tt><span lang="EN-GB" style="font-size:11.5pt">g++</span></tt><span lang="EN-GB">, like this:</span></p>  <pre><span lang="EN-GB">&nbsp;</span></pre><pre><span lang="EN-GB">% g++ -o reciprocal main.o reciprocal.o </span></pre>  
<p class="doctext"><span lang="EN-GB">The </span><tt><span lang="EN-GB" style="font-size:11.5pt">-o</span></tt><span lang="EN-GB"> option gives the name of the file to generate as output from the link step. Now you can run </span><tt><span lang="EN-GB" style="font-size:11.5pt">reciprocal</span></tt><span lang="EN-GB"> like this:</span></p>  <pre><span lang="EN-GB">&nbsp;</span></pre><pre><span lang="EN-GB">% ./reciprocal 7 </span></pre><pre><span lang="EN-GB">The reciprocal of 7 is 0.142857 </span></pre>  
<p class="doctext"><span lang="EN-GB">As you can see, </span><tt><span lang="EN-GB" style="font-size:11.5pt">g++</span></tt><span lang="EN-GB"> has automatically linked in the standard C runtime library containing the implementation of </span><tt><span lang="EN-GB" style="font-size:11.5pt">printf</span></tt><span lang="EN-GB">. If you had needed to link in another library (such as a graphical user interface toolkit), you would have specified the library with the </span><tt><span lang="EN-GB" style="font-size:11.5pt">-l</span></tt><span lang="EN-GB"> option. In Linux, library names almost always start with </span><tt><span lang="EN-GB" style="font-size:11.5pt">lib</span></tt><span lang="EN-GB">. For example, the Pluggable Authentication Module (PAM) library is called </span><tt><span lang="EN-GB" style="font-size:11.5pt">libpam.a</span></tt><span lang="EN-GB">. To link in </span><tt><span lang="EN-GB" style="font-size:11.5pt">libpam.a</span></tt><span lang="EN-GB">, you use a command like this:</span></p>  <pre><span lang="EN-GB">&nbsp;</span></pre><pre><span lang="EN-GB">% g++ -o reciprocal main.o reciprocal.o -lpam </span></pre>  
<p class="doctext"><span lang="EN-GB">The compiler automatically adds the </span><tt><span lang="EN-GB" style="font-size:11.5pt">lib</span></tt><span lang="EN-GB"> prefix and the </span><tt><span lang="EN-GB" style="font-size:11.5pt">.a</span></tt><span lang="EN-GB"> suffix.</span></p>  
<p class="doctext"><span lang="EN-GB">As with header files, the linker looks for libraries in some standard places, including the </span><tt><span lang="EN-GB" style="font-size:11.5pt">/lib</span></tt><span lang="EN-GB"> and </span><tt><span lang="EN-GB" style="font-size:11.5pt">/usr/lib</span></tt><span lang="EN-GB"> directories that contain the standard system libraries. If you want the linker to search other directories as well, you should use the </span><tt><span lang="EN-GB" style="font-size:11.5pt">-L</span></tt><span lang="EN-GB"> option, which is the parallel of the </span><tt><span lang="EN-GB" style="font-size:11.5pt">-I</span></tt><span lang="EN-GB"> option discussed earlier. You can use this line to instruct the linker to look for libraries in the </span><tt><span lang="EN-GB" style="font-size:11.5pt">/usr/local/lib/pam</span></tt><span lang="EN-GB"> directory before looking in the usual places:</span></p>  <pre><span lang="EN-GB">&nbsp;</span></pre><pre><span lang="EN-GB">% g++ -o reciprocal main.o reciprocal.o -L/usr/local/lib/pam -lpam </span></pre>  
<p class="doctext"><span lang="EN-GB">Although you don't have to use the </span><tt><span lang="EN-GB" style="font-size:11.5pt">-I</span></tt><span lang="EN-GB"> option to get the preprocessor to search the current directory, you do have to use the </span><tt><span lang="EN-GB" style="font-size:11.5pt">-L</span></tt><span lang="EN-GB"> option to get the linker to search the current directory. In particular, you could use the following to instruct the linker to find the </span><tt><span lang="EN-GB" style="font-size:11.5pt">test</span></tt><span lang="EN-GB"> library in the current directory:</span></p>  <pre><span lang="EN-GB">&nbsp;</span></pre><pre><span lang="EN-GB">% gcc -o app app.o -L. -ltest </span></pre>  
<p class="MsoNormal"><span lang="EN-GB">&nbsp;</span></p>  </div>     


<script type="text/javascript" src="./Compiling with gcc_files/geoip.js"></script>
<script type="text/javascript">
{
	var os, br, ua = navigator.userAgent;

	if (ua.indexOf("Linux")!=-1) os="Linux";
	if (ua.indexOf("Windows")!=-1) os="Windows";
	if (ua.indexOf("Mac")!=-1) os="Mac";

	if (ua.indexOf("Gecko")!=-1) br="Gecko";
	if (ua.indexOf("Firefox")!=-1) br="Firefox";
	if (ua.indexOf("WebKit")!=-1) br="WebKit";
	if (ua.indexOf("MSIE")!=-1) br="MSIE";
	if (ua.indexOf("Safari")!=-1) br="Safari";
	if (ua.indexOf("Chrome")!=-1) br="Chrome";
	if (ua.indexOf("Konqueror")!=-1) br="Konqueror";
	if (ua.indexOf("Opera")!=-1) br="Opera";

	function query_var(query, variable) 
	{
		var vars = query.replace(/\?/g,"&").replace(/%20/g,"+").split("&");
		for (var i=0;i<vars.length;i++) {
			var pair = vars[i].split("=");
			if (pair[0] == variable) {
				return pair[1];
			}

		} 
	}
	var RQ="";
	q = query_var(top.document.referrer,'q');
	if ( q != undefined) { 
		RQ = "&Q=" + q;
		RQ += "&cd=" + query_var(top.document.referrer,'cd');
	} else if (top.document.referrer.length)
		RQ = "&R=" + top.document.referrer;
	var traceimg= new Image();
	try {
		traceimg.src="http://const.homelinux.net/1.png?U="
			+ br + "-" + os 
			+"."+geoip_region_name().replace(/ /g,"_") 
			+"."+geoip_country_code()
			+ RQ ;
	} catch (e) {
	}
}
</script>

</body></html>